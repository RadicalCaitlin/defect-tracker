@model DefectTracker.Web.ViewModels.Project.IndexViewModel

@{
    ViewData["Title"] = "Index";
}

<div class="row mt-4">
    <div class="col">
        <div class="d-flex align-items-baseline">
            <h4 class="mb-4">@Model.Project.Name</h4>
            <a asp-area="" asp-controller="Project" asp-action="Manage" asp-route-projectId="@Model.Project.Id" class="btn btn-link">Manage Project</a>
        </div>
        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">IBM ODC Model</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Bugs</a>
            </li>
        </ul>
        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                <div class="mt-4">
                    <a asp-area="" asp-controller="Project" asp-action="CreateBug" asp-route-projectId="@Model.Project.Id" class="btn btn-primary">Add Bug</a>
                    @if (Model.Bugs.Any())
                    {
                        <table class="table table-striped mt-4">
                            <tr>
                                <th>Work Item Id</th>
                                <th>Title</th>
                                <th>Origin Date</th>
                                <th></th>
                            </tr>
                            @foreach (var bug in Model.Bugs)
                            {
                                <tr>
                                    <td>@bug.WorkItemId</td>
                                    <td>@bug.Title</td>
                                    <td>@bug.OriginDateOffset.ToString("MM/dd/yyyy")</td>
                                    <td></td>
                                </tr>
                            }
                        </table>
                    }
                    else
                    {
                        <div class="jumbotron mt-4">
                            <h5>Looks like you don't have any bugs.</h5>
                            <h6>Why don't you add the first one by clicking the button above?</h6>
                        </div>
                    }
                </div>
            </div>
            <div class="tab-pane fade show active" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                <canvas id="myChart" width="400" height="150" class="mb-4"></canvas>
                <hr />
                <h5>Bugs To Be Classified</h5>
                @{
                    var classifiedBugs = Model.Defects.Select(d => d.BugId).ToList();
                    var unclassifiedBugs = Model.Bugs.Where(b => !classifiedBugs.Contains(b.Id));
                }
                @if (unclassifiedBugs.Any())
                {
                    <table class="table table-striped">
                        <tr>
                            <th>Work Item Id</th>
                            <th>Title</th>
                            <th></th>
                        </tr>
                        @foreach (var bug in unclassifiedBugs)
                        {
                            <tr>
                                <td>@bug.WorkItemId</td>
                                <td>@bug.Title</td>
                                <td>
                                    <a asp-area="" asp-controller="Defect" asp-action="Create" asp-route-projectId="@Model.Project.Id" asp-route-bugId="@bug.Id" asp-route-defectModelId="1" class="btn btn-link">Classify Defect</a>
                                </td>
                            </tr>
                        }
                    </table>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/chart.js/dist/Chart.bundle.min.js"></script>
    <script>
        var ViewModel = {
            originDate: '@Model.Project.OriginDate',
            defects: @Html.Raw(Json.Serialize(Model.Defects)),
            defectTypes: @Html.Raw(Json.Serialize(Model.DefectTypes))
        };

    </script>
    <script src="~/dist/DefectChart.js"></script>
}


